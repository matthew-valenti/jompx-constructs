"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = require("aws-cdk-lib");
const config_1 = require("./config");
const jompx_config_1 = require("./test/jompx.config");
/**
 * npx jest config.test.ts
 */
let config;
beforeAll(async () => {
    const app = new cdk.App({ context: { ...jompx_config_1.Config, '@jompx-local': { stage: 'prod' } } });
    new cdk.Stack(app);
    config = new config_1.Config(app.node);
});
describe('Config', () => {
    test('stage', () => {
        const stage = config.stage();
        expect(stage).toBe('prod');
    });
    test('environments', () => {
        const environments = config.environments();
        expect(environments).toHaveLength(5);
    });
    test('environmentByName', () => {
        const environment = config.environmentByName('prod');
        expect(environment).toEqual(expect.objectContaining({
            accountId: '281660020318',
            region: 'us-west-2',
            name: 'prod'
        }));
    });
    test('environmentByAccountId', () => {
        const environment = config.environmentByAccountId('281660020318');
        expect(environment).toEqual(expect.objectContaining({
            accountId: '281660020318',
            region: 'us-west-2',
            name: 'prod'
        }));
    });
    test('apps', () => {
        const apps = config.apps();
        expect(apps).toHaveLength(2);
    });
    test('appRootDomainNames', () => {
        const appRootDomainNames = config.appRootDomainNames();
        expect(appRootDomainNames).toContain('jompx.com');
    });
    test('stages', () => {
        const stages = config.stages();
        if (stages) {
            const stagesMap = new Map(Object.entries(stages));
            expect(stagesMap.size).toBe(4);
            expect(stages.prod).toHaveProperty('branch', 'main');
        }
    });
    test('stageDeployments', () => {
        const stageDeployments = config.stageDeployments('prod');
        expect(stageDeployments).toHaveLength(3);
    });
    test('env', () => {
        const env = config.env('app');
        expect(env).toEqual(expect.objectContaining({
            account: '281660020318',
            region: 'us-west-2'
        }));
    });
    test('env + stageName', () => {
        const env = config.env('app', 'test');
        expect(env).toEqual(expect.objectContaining({
            account: '706457422044',
            region: 'us-west-2'
        }));
    });
    test('organizationName', () => {
        const organizationName = config.organizationName();
        expect(organizationName).toBe('my-org');
    });
    test('organizationNamePascalCase', () => {
        const organizationName = config.organizationNamePascalCase();
        expect(organizationName).toBe('MyOrg');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29uZmlnL2NvbmZpZy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbUNBQW1DO0FBQ25DLHFDQUFrQztBQUNsQyxzREFBNEQ7QUFFNUQ7O0dBRUc7QUFFSCxJQUFJLE1BQWMsQ0FBQztBQUVuQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDakIsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUUsR0FBRyxxQkFBVyxFQUFFLGNBQWMsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM1RixJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbkIsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO0lBQ3BCLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO1FBQ2YsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzdCLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUN0QixNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDM0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDM0IsTUFBTSxXQUFXLEdBQUcsTUFBTSxD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QUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUMxQixNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ25ELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM1QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7UUFDcEMsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztRQUM3RCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0MsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XHJcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gJy4vY29uZmlnJztcclxuaW1wb3J0IHsgQ29uZmlnIGFzIEpvbXB4Q29uZmlnIH0gZnJvbSAnLi90ZXN0L2pvbXB4LmNvbmZpZyc7XHJcblxyXG4vKipcclxuICogbnB4IGplc3QgY29uZmlnLnRlc3QudHNcclxuICovXHJcblxyXG5sZXQgY29uZmlnOiBDb25maWc7XHJcblxyXG5iZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoeyBjb250ZXh0OiB7IC4uLkpvbXB4Q29uZmlnLCAnQGpvbXB4LWxvY2FsJzogeyBzdGFnZTogJ3Byb2QnIH0gfSB9KTtcclxuICAgIG5ldyBjZGsuU3RhY2soYXBwKTtcclxuICAgIGNvbmZpZyA9IG5ldyBDb25maWcoYXBwLm5vZGUpO1xyXG59KTtcclxuXHJcbmRlc2NyaWJlKCdDb25maWcnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzdGFnZScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBzdGFnZSA9IGNvbmZpZy5zdGFnZSgpO1xyXG4gICAgICAgIGV4cGVjdChzdGFnZSkudG9CZSgncHJvZCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnZW52aXJvbm1lbnRzJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVudmlyb25tZW50cyA9IGNvbmZpZy5lbnZpcm9ubWVudHMoKTtcclxuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnRzKS50b0hhdmVMZW5ndGgoNSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdlbnZpcm9ubWVudEJ5TmFtZScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBlbnZpcm9ubWVudCA9IGNvbmZpZy5lbnZpcm9ubWVudEJ5TmFtZSgncHJvZCcpO1xyXG4gICAgICAgIGV4cGVjdChlbnZpcm9ubWVudCkudG9FcXVhbChcclxuICAgICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICAgICAgYWNjb3VudElkOiAnMjgxNjYwMDIwMzE4JyxcclxuICAgICAgICAgICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMicsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAncHJvZCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnZW52aXJvbm1lbnRCeUFjY291bnRJZCcsICgpID0+IHtcclxuICAgICAgICBjb25zdCBlbnZpcm9ubWVudCA9IGNvbmZpZy5lbnZpcm9ubWVudEJ5QWNjb3VudElkKCcyODE2NjAwMjAzMTgnKTtcclxuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnQpLnRvRXF1YWwoXHJcbiAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgICAgIGFjY291bnRJZDogJzI4MTY2MDAyMDMxOCcsXHJcbiAgICAgICAgICAgICAgICByZWdpb246ICd1cy13ZXN0LTInLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ3Byb2QnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ2FwcHMnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXBwcyA9IGNvbmZpZy5hcHBzKCk7XHJcbiAgICAgICAgZXhwZWN0KGFwcHMpLnRvSGF2ZUxlbmd0aCgyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ2FwcFJvb3REb21haW5OYW1lcycsICgpID0+IHtcclxuICAgICAgICBjb25zdCBhcHBSb290RG9tYWluTmFtZXMgPSBjb25maWcuYXBwUm9vdERvbWFpbk5hbWVzKCk7XHJcbiAgICAgICAgZXhwZWN0KGFwcFJvb3REb21haW5OYW1lcykudG9Db250YWluKCdqb21weC5jb20nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3N0YWdlcycsICgpID0+IHtcclxuICAgICAgICBjb25zdCBzdGFnZXMgPSBjb25maWcuc3RhZ2VzKCk7XHJcbiAgICAgICAgaWYgKHN0YWdlcykge1xyXG4gICAgICAgICAgICBjb25zdCBzdGFnZXNNYXAgPSBuZXcgTWFwKE9iamVjdC5lbnRyaWVzKHN0YWdlcykpO1xyXG4gICAgICAgICAgICBleHBlY3Qoc3RhZ2VzTWFwLnNpemUpLnRvQmUoNCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChzdGFnZXMucHJvZCkudG9IYXZlUHJvcGVydHkoJ2JyYW5jaCcsICdtYWluJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc3RhZ2VEZXBsb3ltZW50cycsICgpID0+IHtcclxuICAgICAgICBjb25zdCBzdGFnZURlcGxveW1lbnRzID0gY29uZmlnLnN0YWdlRGVwbG95bWVudHMoJ3Byb2QnKTtcclxuICAgICAgICBleHBlY3Qoc3RhZ2VEZXBsb3ltZW50cykudG9IYXZlTGVuZ3RoKDMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnZW52JywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVudiA9IGNvbmZpZy5lbnYoJ2FwcCcpO1xyXG4gICAgICAgIGV4cGVjdChlbnYpLnRvRXF1YWwoXHJcbiAgICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgICAgIGFjY291bnQ6ICcyODE2NjAwMjAzMTgnLFxyXG4gICAgICAgICAgICAgICAgcmVnaW9uOiAndXMtd2VzdC0yJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdlbnYgKyBzdGFnZU5hbWUnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW52ID0gY29uZmlnLmVudignYXBwJywgJ3Rlc3QnKTtcclxuICAgICAgICBleHBlY3QoZW52KS50b0VxdWFsKFxyXG4gICAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgICAgICBhY2NvdW50OiAnNzA2NDU3NDIyMDQ0JyxcclxuICAgICAgICAgICAgICAgIHJlZ2lvbjogJ3VzLXdlc3QtMidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnb3JnYW5pemF0aW9uTmFtZScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBvcmdhbml6YXRpb25OYW1lID0gY29uZmlnLm9yZ2FuaXphdGlvbk5hbWUoKTtcclxuICAgICAgICBleHBlY3Qob3JnYW5pemF0aW9uTmFtZSkudG9CZSgnbXktb3JnJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdvcmdhbml6YXRpb25OYW1lUGFzY2FsQ2FzZScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBvcmdhbml6YXRpb25OYW1lID0gY29uZmlnLm9yZ2FuaXphdGlvbk5hbWVQYXNjYWxDYXNlKCk7XHJcbiAgICAgICAgZXhwZWN0KG9yZ2FuaXphdGlvbk5hbWUpLnRvQmUoJ015T3JnJyk7XHJcbiAgICB9KTtcclxufSk7XHJcbiJdfQ==